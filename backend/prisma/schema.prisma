// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider      = "prisma-client-js"
  output        = "../generated/prisma/client"
  binaryTargets = ["native", "linux-musl"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int    @id @default(autoincrement())
  firstname    String @db.VarChar(30)
  lastname     String @db.VarChar(30)
  email        String @unique @db.VarChar(50)
  phone_number String @unique @db.Char(10)
  user_name    String @unique @db.VarChar(50)
  password     String @db.VarChar(255)
  role         Role   @default(CUSTOMER)

  staff    Staff?
  customer Customer?
}

model Staff {
  id           Int    @id @default(autoincrement())
  wages        Float  @db.DoublePrecision
  bank_company Bank   @default(KASIKORN)
  bank_account String @unique

  userId          Int              @unique
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  replies         ChatLog[]
  cares           Care[]
  staffOnServices StaffOnService[]
  roomStaff       RoomStaff[]
}

model Customer {
  id Int @id @default(autoincrement())

  userId   Int       @unique
  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  chats    ChatLog[]
  pets     Pet[]
  bookings Booking[]
  payments Payment[]
  Cart     Cart[]
}

model ChatLog {
  id          Int       @id @default(autoincrement())
  review      String?   @db.Text
  reply       String?   @db.Text
  rating      Float?    @default(5) @db.DoublePrecision
  review_date DateTime  @default(now()) @db.Date()
  reply_date  DateTime? @db.Date()
  show        Boolean   @default(true) @db.Boolean
  isRead      Boolean   @default(false) @db.Boolean

  customerId Int?
  customer   Customer? @relation(fields: [customerId], references: [id], onDelete: SetNull)
  staffId    Int?
  staff      Staff?    @relation(fields: [staffId], references: [id], onDelete: SetNull)
  serviceId  Int?
  service    Service?  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  roomId     Int?
  room       Room?     @relation(fields: [roomId], references: [id], onDelete: Cascade)
}

model Pet {
  id       Int       @id @default(autoincrement())
  name     String    @db.VarChar(30)
  sex      Sex       @default(MALE)
  age      Int
  type     PetType   @default(DOG)
  status   PetStatus @default(IDLE)
  breed    String    @db.VarChar(30)
  disease  String[]  @db.VarChar(30)
  allergic String[]  @db.VarChar(30)
  picture  String    @default("https://storage.googleapis.com/paw_image/unnamed.jpg")

  scheduled   BookedService[]
  stayed      BookedRoom[]
  customerId  Int
  customer    Customer        @relation(fields: [customerId], references: [id], onDelete: Cascade)
  cares       Care[]
  CartRoom    CartRoom[]
  CartService CartService[]
}

model Room {
  id       Int     @id @default(autoincrement())
  name     String  @db.VarChar(30)
  number   Int     @unique @default(100) @db.Integer
  capacity Int     @default(1) @db.Integer
  price    Float   @default(2000.00) @db.DoublePrecision
  picture  String  @default("https://storage.googleapis.com/paw_image/unnamed.jpg")
  petType  PetType @default(DOG)

  bookings     BookedRoom[]
  staffOnRooms RoomStaff[]
  ChatLog      ChatLog[]
  CartRoom     CartRoom[]
}

model BookedRoom {
  id       Int              @id @default(autoincrement())
  checkIn  DateTime         @db.Timestamp(0)
  checkOut DateTime         @db.Timestamp(0)
  status   BookedRoomStatus @default(RESERVED)

  roomId    Int
  room      Room    @relation(fields: [roomId], references: [id], onDelete: Cascade)
  petId     Int?
  pet       Pet?    @relation(fields: [petId], references: [id], onDelete: SetNull)
  bookingId Int
  booking   Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  Care      Care[]
}

model Service {
  id      Int       @id @default(autoincrement())
  name    String    @db.VarChar(30)
  price   Float     @default(500.00) @db.DoublePrecision
  petType PetType[]
  picture String    @default("https://storage.googleapis.com/paw_image/unnamed.jpg")

  reviews         ChatLog[]
  staffOnServices StaffOnService[]
  bookedServices  BookedService[]
  CartService     CartService[]
}

model BookedService {
  id        Int                 @id @default(autoincrement())
  scheduled DateTime            @db.Timestamp(0)
  status    BookedServiceStatus @default(RESERVED)

  serviceId  Int
  service    Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  petId      Int?
  pet        Pet?    @relation(fields: [petId], references: [id], onDelete: SetNull)
  booking_id Int
  booking    Booking @relation(fields: [booking_id], references: [id], onDelete: Cascade)
  Care       Care[]
}

model Booking {
  id     Int           @id @default(autoincrement())
  date   DateTime      @db.Timestamp(0)
  status BookingStatus @default(BOOKED)

  booked_service BookedService[]
  booked_room    BookedRoom[]
  customerId     Int?
  customer       Customer?       @relation(fields: [customerId], references: [id], onDelete: SetNull)
  paymentId      Int             @unique
  payment        Payment         @relation(fields: [paymentId], references: [id], onDelete: Cascade)
  customerName   String          @db.VarChar(60)
  customerEmail  String          @db.VarChar(50)
  customerNumber String          @db.Char(10)
}

model Cart {
  id         Int      @id @default(autoincrement())
  customerId Int
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  cartRooms    CartRoom[]
  cartServices CartService[]
}

model CartRoom {
  id     Int  @id @default(autoincrement())
  cartId Int
  cart   Cart @relation(fields: [cartId], references: [id], onDelete: Cascade)

  roomId Int
  room   Room @relation(fields: [roomId], references: [id], onDelete: Cascade)

  petId Int
  pet   Pet @relation(fields: [petId], references: [id], onDelete: Cascade)

  checkIn  DateTime
  checkOut DateTime
  selected Boolean  @default(false)
}

model CartService {
  id     Int  @id @default(autoincrement())
  cartId Int
  cart   Cart @relation(fields: [cartId], references: [id], onDelete: Cascade)

  serviceId Int
  service   Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  petId Int
  pet   Pet @relation(fields: [petId], references: [id], onDelete: Cascade)

  scheduled DateTime
  selected  Boolean  @default(false)
}

model Payment {
  id     Int           @id @default(autoincrement())
  cost   Float         @db.DoublePrecision
  date   DateTime      @default(now()) @db.Timestamp(0)
  status PaymentStatus @default(PENDING)
  slip   String

  booking    Booking?
  customerId Int?
  customer   Customer? @relation(fields: [customerId], references: [id], onDelete: SetNull)
}

model Care {
  id     Int       @id @default(autoincrement())
  date   DateTime  @default(now()) @db.Timestamp(0)
  status PetStatus

  staff_id      Int
  staff         Staff          @relation(fields: [staff_id], references: [id], onDelete: Cascade)
  pet_id        Int
  pet           Pet            @relation(fields: [pet_id], references: [id], onDelete: Cascade)
  bs_id         Int?
  bookedService BookedService? @relation(fields: [bs_id], references: [id], onDelete: SetNull)
  br_id         Int?
  bookedRoom    BookedRoom?    @relation(fields: [br_id], references: [id], onDelete: SetNull)
}

model StaffOnService {
  staffId   Int
  serviceId Int

  staff   Staff   @relation(fields: [staffId], references: [id], onDelete: Cascade)
  service Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@id([staffId, serviceId])
}

model RoomStaff {
  roomId  Int
  staffId Int

  room  Room  @relation(fields: [roomId], references: [id], onDelete: Cascade)
  staff Staff @relation(fields: [staffId], references: [id], onDelete: Cascade)

  @@id([roomId, staffId])
}

enum Role {
  STAFF
  CUSTOMER
}

enum Bank {
  KASIKORN
  SCB
  KRUNGTHAI
}

enum PetType {
  DOG
  CAT
  MOUSE
  RABBIT
  BIRD
}

enum Sex {
  MALE
  FEMALE
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
}

enum BookingStatus {
  BOOKED
  CANCELLED
}

enum BookedRoomStatus {
  RESERVED
  QUEUE
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum BookedServiceStatus {
  RESERVED
  CHECKED_IN
  CHECKED_OUT
  CANCELLED
}

enum PetStatus {
  IDLE
  RESERVED
  CHECKED_IN
  CHECKED_OUT
  QUEUE
  IN_PROGRESS
  COMPLETED
}
